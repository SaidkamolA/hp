// –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
const giftBox = document.getElementById('giftBox');
const videoModal = document.getElementById('videoModal');
const closeModal = document.getElementById('closeModal');
const confettiContainer = document.getElementById('confettiContainer');
const fireworkContainer = document.getElementById('fireworkContainer');
const backgroundMusic = document.getElementById('backgroundMusic');
const musicToggle = document.getElementById('musicToggle');

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω–æ–≤—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ä–µ–º–µ–Ω–∏
function setBackgroundByTime() {
    const hour = new Date().getHours() + 5; // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è +05
    if (hour >= 12 && hour < 17) {
        document.body.classList.add('afternoon');
    }
}
setBackgroundByTime();

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        giftBox.style.animation = 'giftFloat 4s ease-in-out infinite';
    }, 1000);
    
    createFloatingElements();
    
    console.log('Gift box:', giftBox);
    console.log('Video modal:', videoModal);
    console.log('Close modal:', closeModal);
    console.log('Background music:', backgroundMusic);
    console.log('Music toggle:', musicToggle);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ø–æ–¥–∞—Ä–∫—É
giftBox.addEventListener('click', function() {
    console.log('–ü–æ–¥–∞—Ä–æ–∫ –Ω–∞–∂–∞—Ç!');
    openGift();
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
closeModal.addEventListener('click', function() {
    console.log('–ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞');
    closeGift();
    createCloseConfetti();
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
videoModal.addEventListener('click', function(e) {
    if (e.target === videoModal) {
        closeGift();
        createCloseConfetti();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && videoModal.classList.contains('show')) {
        closeGift();
        createCloseConfetti();
    }
});

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞
function openGift() {
    console.log('–§—É–Ω–∫—Ü–∏—è openGift –≤—ã–∑–≤–∞–Ω–∞');
    
    giftBox.classList.add('opening');
    
    setTimeout(() => {
        giftBox.style.transform = 'scale(1.5) translateY(-10%)';
        giftBox.style.transition = 'transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        videoModal.classList.add('show');
        createConfetti();
        createSparkles();
        createFireworks();
        playGiftSound();
        const video = document.getElementById('birthdayVideo');
        if (video) {
            video.play().catch(e => console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'));
        }
    }, 1500);
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞
function closeGift() {
    videoModal.classList.remove('show');
    giftBox.classList.remove('opening');
    giftBox.style.transform = 'scale(1)';
    giftBox.style.transition = 'transform 0.5s ease-in-out';
    const video = document.getElementById('birthdayVideo');
    if (video) {
        video.pause();
        video.currentTime = 0;
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
function createConfetti() {
    const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#ff8e8e', '#a8e6cf', '#ffb3ba'];
    for (let i = 0; i < 150; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = Math.random() * 1.5 + 's';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            confettiContainer.appendChild(confetti);
            setTimeout(() => confetti.remove(), 4000);
        }, i * 30);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∏—Å–∫—Ä
function createSparkles() {
    const sparkleContainer = document.createElement('div');
    sparkleContainer.className = 'sparkle-container';
    document.body.appendChild(sparkleContainer);
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + 'vw';
            sparkle.style.top = Math.random() * 100 + 'vh';
            sparkle.style.animationDelay = Math.random() * 1 + 's';
            sparkleContainer.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 2000);
        }, i * 20);
    }
    setTimeout(() => sparkleContainer.remove(), 2500);
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–æ–≤
function createFireworks() {
    const fireworkCount = 10;
    for (let i = 0; i < fireworkCount; i++) {
        setTimeout(() => {
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = Math.random() * 100 + 'vw';
            firework.style.top = Math.random() * 100 + 'vh';
            fireworkContainer.appendChild(firework);
            setTimeout(() => firework.remove(), 1500);
        }, i * 200);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
function createCloseConfetti() {
    for (let i = 0; i < 50; i++) {
        setTimeout(() => {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.backgroundColor = '#ffeb3b';
            confetti.style.animationDelay = Math.random() * 0.5 + 's';
            confetti.style.animationDuration = (Math.random() * 1.5 + 1.5) + 's';
            confettiContainer.appendChild(confetti);
            setTimeout(() => confetti.remove(), 2000);
        }, i * 20);
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–ª–∞–≤–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
function createFloatingElements() {
    const container = document.querySelector('.background');
    for (let i = 0; i < 8; i++) {
        setTimeout(() => {
            const element = document.createElement('div');
            const emojis = ['üéâ', 'üéä', 'üéà', 'üéÅ', 'üç∞', 'üíù', 'üåü', '‚ú®', 'üé¨', 'üíú', 'üé≠', 'üçø', 'üé™', 'üé®', 'üéµ', 'üé§'];
            element.innerHTML = emojis[Math.floor(Math.random() * emojis.length)];
            element.style.position = 'absolute';
            element.style.left = Math.random() * 100 + '%';
            element.style.top = Math.random() * 100 + '%';
            element.style.fontSize = clamp(1, Math.random() * 1.5 + 0.8, 2) + 'rem';
            element.style.opacity = '0.6';
            element.style.animation = `float ${Math.random() * 4 + 4}s ease-in-out infinite`;
            element.style.animationDelay = Math.random() * 2 + 's';
            container.appendChild(element);
        }, i * 800);
    }
}

function clamp(min, val, max) {
    return Math.min(Math.max(val, min), max);
}

// –ó–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ–¥–∞—Ä–∫–∞
function playGiftSound() {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.frequency.setValueAtTime(880, audioContext.currentTime); // High A note
        oscillator.type = 'square';
        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.8);
    } catch (e) {
        console.log('–ó–≤—É–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    }
}

// –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –∏ –∫–ª–∏–∫–µ
giftBox.addEventListener('mouseenter', function() {
    this.style.filter = 'brightness(1.2) drop-shadow(0 0 20px rgba(255,255,255,0.5))';
});

giftBox.addEventListener('mouseleave', function() {
    this.style.filter = 'brightness(1) drop-shadow(0 15px 30px rgba(0,0,0,0.2))';
});

giftBox.addEventListener('mousedown', function() {
    this.style.animation = 'shake 0.5s ease-in-out';
});

giftBox.addEventListener('mouseup', function() {
    setTimeout(() => {
        this.style.animation = 'giftFloat 4s ease-in-out infinite';
    }, 500);
});

function animateOnScroll() {
    const elements = document.querySelectorAll('.gift-container, .main-title');
    elements.forEach(element => {
        const elementTop = element.getBoundingClientRect().top;
        const elementVisible = 150;
        if (elementTop < window.innerHeight - elementVisible) {
            element.style.opacity = '1';
            element.style.transform = 'translateY(0)';
        }
    });
}

window.addEventListener('scroll', animateOnScroll);
animateOnScroll();

function animateBTSHearts() {
    const hearts = document.querySelectorAll('.bts-hearts span');
    hearts.forEach((heart, index) => {
        setTimeout(() => {
            heart.style.transform = 'scale(1.5) rotate(15deg)';
            heart.style.filter = 'brightness(1.5) drop-shadow(0 0 10px #ff69b4)';
            setTimeout(() => {
                heart.style.transform = 'scale(1) rotate(0deg)';
                heart.style.filter = 'brightness(1) drop-shadow(0 4px 8px rgba(102, 126, 234, 0.3))';
            }, 300);
        }, index * 200);
    });
}

setInterval(animateBTSHearts, 3000);

if (musicToggle) {
    musicToggle.addEventListener('click', function() {
        if (backgroundMusic.paused) {
            backgroundMusic.play();
            musicToggle.textContent = '‚è∏Ô∏è';
            musicToggle.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
        } else {
            backgroundMusic.pause();
            musicToggle.textContent = '‚ñ∂Ô∏è';
            musicToggle.style.background = 'linear-gradient(45deg, #ff6b6b, #ff8e8e)';
        }
    });
}

document.addEventListener('click', function() {
    if (backgroundMusic && backgroundMusic.paused) {
        backgroundMusic.play().then(() => {
            if (musicToggle) {
                musicToggle.textContent = '‚è∏Ô∏è';
                musicToggle.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
            }
        }).catch(e => console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'));
    }
}, { once: true });